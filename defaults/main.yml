---
nginx_software: nginx #openresty #nginx

nginx_openresty_copy_lua_files: false
nginx_openresty_lua_config:
  - lua_package_path '~/lua/?.lua;;';
  - resolver 127.0.0.53:53;
  - lua_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;
  - lua_ssl_verify_depth 5;
  - '# cache for discovery metadata documents'
  -  lua_shared_dict discovery 1m;
  - '# cache for JWKs'
  - lua_shared_dict jwks 1m;

nginx_revproxy_sites:                                         # List of sites to reverse proxy
  - name: example.com                                         # Domain name
    listen:
      - 80
    listen_ssl:
      - 443
    client_max_body_size: "256M"
    proxy_read_timeout: "360"
    domains:                                                  # List of server_name aliases
      - example.com
      - www.example.com
    upstreams:                                                # List of Upstreams
      - {backend_address: 192.168.0.100, backend_port: 80}
      - {backend_address: 192.168.0.101, backend_port: 8080}
    nginx_ssl_certificate: "/etc/letsencrypt/live/{{ item.name }}/fullchain.pem"
    nginx_ssl_certificate_key: "/etc/letsencrypt/live/{{ item.name }}/privkey.pem"
    conn_upgrade: false
    forward_header: true
    lua_action: ""
    locations: []
    # path:
    # config:


# Remove WebRoot Sites
nginx_revproxy_remove_webroot_sites: true

# De-activate Sites
nginx_revproxy_de_activate_sites: true

# Generate Certificates with Letsencrypt
# h2_certbot_certs: []

# Upload Custom Certificates from Vault
# h2_custom_cert_certiciate: []